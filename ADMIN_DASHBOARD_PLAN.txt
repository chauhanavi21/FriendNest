Admin Dashboard Implementation Plan

Project: FriendNest Admin Dashboard
Purpose: Create a secure backend admin dashboard to monitor and manage the platform
Principle: Non-disruptive implementation - existing functionality remains unchanged

================================================================================

TABLE OF CONTENTS

1. Overview
2. Architecture Decision
3. Step-by-Step Implementation Plan
4. Database Changes
5. Backend Implementation
6. Frontend Implementation
7. Security Considerations
8. Statistics & Metrics
9. Admin Features
10. Testing Strategy

================================================================================

OVERVIEW

Goals
- Create a secure admin-only dashboard
- Display comprehensive platform statistics
- Enable user management capabilities
- Monitor groups, events, and notifications
- Track system health and activity
- Zero disruption to existing user-facing features

Key Requirements
- Separate admin authentication (not mixed with regular users)
- Role-based access control (admin role in User model)
- Secure middleware to protect admin routes
- Comprehensive statistics dashboard
- User management (view, block, delete users)
- Groups management (view, delete groups)
- Activity monitoring and analytics

================================================================================

ARCHITECTURE DECISION

Option A: Separate Admin Frontend (Recommended)
Pros:
- Complete separation of concerns
- Can use different tech stack if needed
- No risk of exposing admin UI to regular users
- Easier to deploy separately

Cons:
- Requires maintaining two frontend codebases
- More complex deployment

Option B: Admin Section in Main App (Chosen for Simplicity)
Pros:
- Single codebase
- Shared components and styles
- Easier maintenance
- Same deployment process

Cons:
- Need careful route protection
- Admin UI accessible (but protected) in main app

Decision: Option B - Admin section in main app with strict route protection

Admin Routes Structure
- Frontend: /admin/* (all routes protected)
- Backend: /api/admin/* (all routes protected with admin middleware)

================================================================================

STEP-BY-STEP IMPLEMENTATION PLAN

PHASE 1: Database & Authentication Setup

Step 1.1: Add Admin Role to User Model
File: backend/src/models/User.js

Changes:
- Add role field to userSchema:
  role: {
    type: String,
    enum: ["user", "admin"],
    default: "user",
  },
- Add index: userSchema.index({ role: 1 });

Impact:
- Non-breaking: All existing users default to "user" role
- Backward compatible
- No migration needed (default value handles existing records)

Verification:
- Check existing users still work
- Verify new users default to "user" role

Step 1.2: Create Initial Admin User (Manual Setup)
Approach: Manual database operation or admin script

Option A: Direct MongoDB operation
// Run once manually or via script
db.users.updateOne(
  { email: "your-admin@email.com" },
  { $set: { role: "admin" } }
);

Option B: Create admin setup script
File: backend/scripts/createAdmin.js
- Script to promote a user to admin
- Usage: node scripts/createAdmin.js <user-email>
- Includes validation and security checks

Recommendation: Option A for initial setup, Option B for future admins

Step 1.3: Create Admin Authentication Middleware
File: backend/src/middleware/auth.middleware.js

Add new function: requireAdmin
export const requireAdmin = async (req, res, next) => {
  try {
    // First check if user is authenticated (use protectRoute logic)
    // Then check if user.role === "admin"
    // If not admin, return 403 Forbidden
  } catch (error) {
    // Error handling
  }
};

Logic Flow:
1. Extract JWT token from cookies
2. Verify token
3. Find user by userId
4. Check if user.role === "admin"
5. If not admin: return 403 Forbidden
6. If admin: attach user to req and continue

Impact:
- New middleware, doesn't affect existing protectRoute
- Existing routes unchanged

PHASE 2: Backend Admin Controllers

Step 2.1: Create Admin Statistics Controller
File: backend/src/controllers/admin.controller.js

Functions to implement:

1. getDashboardStats
   - Total users count
   - Onboarded users count
   - Total groups count
   - Total events count
   - Total friend requests count (by status)
   - Total notifications count
   - Total friendships (unique pairs)
   - Users created today/this week/this month
   - Active users (logged in last 7 days) - if you add lastLogin field
   - Groups by language breakdown
   - Recent activity (last 10 users, groups, etc.)

2. getUserStats (if needed separately)
   - User registration trends
   - Users by native language
   - Users by location
   - Users with/without profile pictures
   - Average friends per user

3. getGroupStats (if needed separately)
   - Groups by language
   - Average members per group
   - Groups with most members
   - Events by status (upcoming/past)

4. getActivityStats
   - Friend requests sent today/week/month
   - Notifications created today/week/month
   - Groups created today/week/month
   - Events created today/week/month

Database Queries Needed:
// Example queries structure
- User.countDocuments({ role: "user" })
- User.countDocuments({ isOnboarded: true })
- Group.countDocuments()
- Group.aggregate([{ $group: { _id: "$language", count: { $sum: 1 } } }])
- FriendRequest.countDocuments({ status: "pending" })
- Notification.countDocuments({ isRead: false })
// ... etc

Response Format:
{
  "success": true,
  "stats": {
    "users": {
      "total": 150,
      "onboarded": 120,
      "notOnboarded": 30,
      "createdToday": 5,
      "createdThisWeek": 25,
      "createdThisMonth": 80
    },
    "groups": {
      "total": 45,
      "byLanguage": { "Spanish": 15, "French": 10, ... },
      "totalMembers": 300
    },
    "events": {
      "total": 120,
      "upcoming": 45,
      "past": 75
    },
    "friendRequests": {
      "total": 500,
      "pending": 50,
      "accepted": 400,
      "removed": 50
    },
    "notifications": {
      "total": 2000,
      "unread": 150
    },
    "friendships": 350
  }
}

Step 2.2: Create Admin User Management Controller
File: backend/src/controllers/admin.controller.js (continue)

Functions:

1. getAllUsers
   - Pagination support (page, limit)
   - Search by name/email
   - Sort by registration date, name
   - Filter by onboarded status
   - Return: id, name, email, profilePic, isOnboarded, createdAt, friends count, groups count

2. getUserById
   - Get detailed user info
   - Include friends list
   - Include groups they're in
   - Include friend requests sent/received
   - Include notification count

3. updateUser (optional - for admin to edit user details)
   - Update user profile
   - Update settings
   - Block/unblock user (if you add blocked field)

4. deleteUser
   - Delete user account
   - Cascade delete: remove from friends lists, groups, notifications
   - Remove friend requests
   - Important: Handle Stream user deletion too
   - Security: Never allow deleting another admin

5. blockUser / unblockUser (if implementing blocking feature)
   - Add isBlocked field to User model
   - Blocked users cannot login
   - Blocked users are hidden from other users

Step 2.3: Create Admin Group Management Controller
File: backend/src/controllers/admin.controller.js (continue)

Functions:

1. getAllGroups
   - Pagination support
   - Search by name/description
   - Filter by language
   - Sort by creation date, member count
   - Return: id, name, description, language, creator, member count, event count, createdAt

2. getGroupById (detailed view)
   - Full group details
   - All members list
   - All events list
   - Creator info

3. deleteGroup
   - Delete group (admin can delete any group)
   - Remove group from all members' data
   - Delete Stream channel if exists
   - Cascade delete events

Step 2.4: Create Admin Analytics Controller (Optional - Future Enhancement)
File: backend/src/controllers/admin.controller.js (continue)

Functions (for future):
- getRegistrationTrends - Users registered over time
- getLanguageDistribution - Language usage statistics
- getActivityHeatmap - Activity by day/hour
- getUserGrowth - Growth metrics
- getEngagementMetrics - Active users, messages sent, etc.

PHASE 3: Backend Admin Routes

Step 3.1: Create Admin Routes File
File: backend/src/routes/admin.route.js

Route Structure:
// Statistics
GET    /api/admin/stats/dashboard     - Get dashboard overview stats
GET    /api/admin/stats/users         - Get user statistics
GET    /api/admin/stats/groups        - Get group statistics
GET    /api/admin/stats/activity      - Get activity statistics

// User Management
GET    /api/admin/users               - Get all users (paginated)
GET    /api/admin/users/:id           - Get user by ID
PUT    /api/admin/users/:id           - Update user (optional)
DELETE /api/admin/users/:id           - Delete user
POST   /api/admin/users/:id/block     - Block user (if implemented)
POST   /api/admin/users/:id/unblock   - Unblock user (if implemented)

// Group Management
GET    /api/admin/groups              - Get all groups (paginated)
GET    /api/admin/groups/:id          - Get group by ID
DELETE /api/admin/groups/:id          - Delete group

Middleware Usage:
- All routes use requireAdmin middleware
- Example: router.get("/stats/dashboard", requireAdmin, getDashboardStats);

Pagination Middleware (optional helper):
- Create pagination helper for consistent pagination
- Query params: ?page=1&limit=20&search=...&sort=createdAt&order=desc

Step 3.2: Register Admin Routes in Server
File: backend/src/server.js

Changes:
import adminRoutes from "./routes/admin.route.js";

// Add route (after other routes)
app.use("/api/admin", adminRoutes);

Impact:
- New routes, no conflict with existing routes
- All routes protected by admin middleware

PHASE 4: Frontend Admin Authentication

Step 4.1: Add Admin Login Check
Option A: Use existing login but check role after login
Option B: Separate admin login page (recommended)

Recommended: Option B - Separate Admin Login

File: frontend/src/pages/AdminLoginPage.jsx (new)

Features:
- Simple login form (email + password)
- Separate from regular login
- After login, check if user role === "admin"
- If admin: navigate to /admin/dashboard
- If not admin: show error "Access Denied"

File: frontend/src/lib/api.js

Add function:
export const adminLogin = async (email, password) => {
  // Use existing login API
  // Then check user.role === "admin"
  // Return admin user object
};

Step 4.2: Create Admin Auth Hook
File: frontend/src/hooks/useAdminAuth.js (new)

Purpose:
- Check if current user is admin
- Redirect to admin login if not admin
- Manage admin session

Logic:
export const useAdminAuth = () => {
  const { user, isLoading } = useAuthUser(); // Existing hook
  
  useEffect(() => {
    if (!isLoading && (!user || user.role !== "admin")) {
      // Redirect to /admin/login
    }
  }, [user, isLoading]);
  
  return { isAdmin: user?.role === "admin", user, isLoading };
};

Step 4.3: Create Admin Route Protection
File: frontend/src/components/AdminProtectedRoute.jsx (new)

Purpose:
- Wrapper component for admin routes
- Checks admin status
- Redirects non-admin users

Usage:
<Route 
  path="/admin/*" 
  element={
    <AdminProtectedRoute>
      <AdminLayout>
        <Routes>
          {/* Admin routes */}
        </Routes>
      </AdminLayout>
    </AdminProtectedRoute>
  } 
/>

PHASE 5: Frontend Admin Dashboard

Step 5.1: Create Admin Layout Component
File: frontend/src/components/AdminLayout.jsx (new)

Features:
- Admin navigation sidebar
- Admin header with logout
- Different from regular Layout (no regular sidebar)
- Navigation items:
  - Dashboard (overview)
  - Users
  - Groups
  - Statistics
  - Settings (if needed)

Design:
- Use existing DaisyUI components
- Match app theme but distinct admin styling
- Responsive (mobile-friendly)

Step 5.2: Create Admin Dashboard Page (Overview)
File: frontend/src/pages/admin/DashboardPage.jsx (new)

Sections:
1. Statistics Cards (grid layout)
   - Total Users
   - Total Groups
   - Total Events
   - Total Friend Requests
   - Unread Notifications
   - Total Friendships

2. Quick Stats (charts/graphs - future enhancement)
   - User growth over time
   - Groups by language
   - Activity trends

3. Recent Activity (tables)
   - Recent users
   - Recent groups
   - Recent events

Data Fetching:
- Use TanStack Query
- API: GET /api/admin/stats/dashboard
- Auto-refresh every 30-60 seconds

Components Needed:
- StatCard.jsx - Reusable stat card component
- ActivityTable.jsx - Reusable activity table

Step 5.3: Create Admin Users Page
File: frontend/src/pages/admin/UsersPage.jsx (new)

Features:
1. User List Table
   - Columns: Avatar, Name, Email, Onboarded, Friends, Groups, Created At, Actions
   - Pagination
   - Search by name/email
   - Sort by name, created date
   - Filter by onboarded status

2. User Actions
   - View details (modal or navigate to detail page)
   - Delete user (with confirmation)
   - Block/Unblock (if implemented)

3. User Detail View (optional separate page)
   - Full user profile
   - Friends list
   - Groups list
   - Friend requests
   - Activity history

Data Fetching:
- API: GET /api/admin/users?page=1&limit=20&search=...
- Use TanStack Query with pagination

Components Needed:
- UserTable.jsx - User list table
- UserDetailModal.jsx - User details modal
- DeleteUserModal.jsx - Delete confirmation

Step 5.4: Create Admin Groups Page
File: frontend/src/pages/admin/GroupsPage.jsx (new)

Features:
1. Group List Table
   - Columns: Name, Language, Creator, Members, Events, Created At, Actions
   - Pagination
   - Search by name
   - Filter by language
   - Sort by creation date, member count

2. Group Actions
   - View details
   - Delete group (with confirmation)

3. Group Detail View
   - Full group info
   - Members list
   - Events list
   - Creator info

Data Fetching:
- API: GET /api/admin/groups?page=1&limit=20

Step 5.5: Create Admin Statistics Page (Optional - Advanced)
File: frontend/src/pages/admin/StatisticsPage.jsx (new)

Features:
- Detailed analytics
- Charts and graphs (using a chart library like recharts)
- Export data (CSV/JSON)
- Date range filters
- Custom reports

Step 5.6: Add Admin Routes to App
File: frontend/src/App.jsx

Changes:
// Add admin routes
import AdminLoginPage from "./pages/AdminLoginPage";
import AdminProtectedRoute from "./components/AdminProtectedRoute";
import AdminLayout from "./components/AdminLayout";
import DashboardPage from "./pages/admin/DashboardPage";
import UsersPage from "./pages/admin/UsersPage";
import GroupsPage from "./pages/admin/GroupsPage";

// In Routes
<Route path="/admin/login" element={<AdminLoginPage />} />
<Route 
  path="/admin/*" 
  element={
    <AdminProtectedRoute>
      <AdminLayout>
        <Routes>
          <Route path="dashboard" element={<DashboardPage />} />
          <Route path="users" element={<UsersPage />} />
          <Route path="groups" element={<GroupsPage />} />
          <Route path="stats" element={<StatisticsPage />} />
          <Route index element={<Navigate to="/admin/dashboard" replace />} />
        </Routes>
      </AdminLayout>
    </AdminProtectedRoute>
  } 
/>

Step 5.7: Add Admin API Functions
File: frontend/src/lib/api.js

Add functions:
// Statistics
export const getAdminDashboardStats = () => { ... }
export const getAdminUserStats = () => { ... }
export const getAdminGroupStats = () => { ... }

// Users
export const getAllAdminUsers = (params) => { ... }
export const getAdminUserById = (userId) => { ... }
export const deleteAdminUser = (userId) => { ... }

// Groups
export const getAllAdminGroups = (params) => { ... }
export const getAdminGroupById = (groupId) => { ... }
export const deleteAdminGroup = (groupId) => { ... }

PHASE 6: Security Enhancements

Step 6.1: Admin Session Management
- Admin sessions can be longer (30 days vs 7 days) or same
- Consider separate admin JWT token
- Log admin actions (audit log - future)

Step 6.2: Rate Limiting (Optional)
- Add rate limiting to admin routes
- Prevent brute force attacks
- Use express-rate-limit

Step 6.3: IP Whitelisting (Optional - Future)
- Restrict admin login to specific IPs
- Environment variable for allowed IPs

Step 6.4: Admin Activity Logging (Optional - Future)
- Log all admin actions
- Store in separate collection
- Track: action, admin user, timestamp, details

================================================================================

STATISTICS & METRICS

Dashboard Statistics to Display

1. User Metrics:
   - Total users
   - Onboarded users
   - Users created today/this week/this month
   - Users by native language (top 5)
   - Users with profiles (has bio, profilePic, etc.)
   - Average friends per user

2. Group Metrics:
   - Total groups
   - Groups by language (breakdown)
   - Average members per group
   - Groups created today/this week/this month
   - Most active groups (by member count)

3. Event Metrics:
   - Total events
   - Upcoming events
   - Past events
   - Events created today/this week/this month

4. Friend Request Metrics:
   - Total friend requests
   - Pending requests
   - Accepted requests
   - Removed requests
   - Friend requests today/this week/this month

5. Notification Metrics:
   - Total notifications
   - Unread notifications
   - Notifications by type (friendRequest, message, etc.)

6. Friendship Metrics:
   - Total friendships (unique pairs)
   - Average friendships per user

7. Activity Metrics:
   - New users today/this week/this month
   - New groups today/this week/this month
   - New events today/this week/this month

================================================================================

ADMIN FEATURES

Core Features (Phase 1)

1. Dashboard Overview
   - View all statistics
   - Quick metrics cards
   - Recent activity feed

2. User Management
   - View all users (paginated, searchable)
   - View user details
   - Delete users
   - Block/unblock users (optional)
   - Edit user details (optional)

3. Group Management
   - View all groups (paginated, searchable)
   - View group details
   - Delete groups

Advanced Features (Future Phases)

4. Analytics & Reporting
   - Detailed charts and graphs
   - Export data (CSV, JSON)
   - Custom date ranges
   - User growth trends
   - Engagement metrics

5. Content Moderation
   - Review reported content
   - Moderate groups
   - Moderate events

6. System Settings
   - Platform configuration
   - Feature flags
   - Maintenance mode

7. Audit Logs
   - Admin action logs
   - User activity logs
   - System event logs

================================================================================

SECURITY CONSIDERATIONS

Authentication & Authorization
1. Role-based access control
   - Only users with role: "admin" can access admin routes
   - Check role on both frontend and backend

2. Middleware Protection
   - All admin routes protected by requireAdmin middleware
   - Never trust frontend-only checks

3. Session Security
   - Use same JWT security as regular users
   - Consider separate admin tokens (optional)

4. Password Security
   - Admins must use strong passwords
   - Consider 2FA for admins (future)

Data Protection
1. Sensitive Data
   - Don't expose passwords in API responses
   - Don't expose sensitive user data unnecessarily
   - Limit data in list views

2. Cascade Deletes
   - Properly handle user deletion (remove from friends, groups, etc.)
   - Handle Stream user deletion
   - Handle database cleanup

3. Validation
   - Validate all admin inputs
   - Sanitize search queries
   - Prevent SQL injection (MongoDB handles, but be careful with queries)

Best Practices
1. Never allow deleting other admins (safety check)
2. Log admin actions (for audit trail)
3. Rate limiting (prevent abuse)
4. Error messages (don't leak sensitive info)
5. HTTPS only (in production)

================================================================================

TESTING STRATEGY

Backend Testing
1. Middleware Tests
   - Test requireAdmin middleware
   - Test with non-admin users (should fail)
   - Test with admin users (should pass)
   - Test with invalid tokens

2. Controller Tests
   - Test statistics endpoints
   - Test user management endpoints
   - Test group management endpoints
   - Test error handling

3. Security Tests
   - Test unauthorized access attempts
   - Test privilege escalation attempts
   - Test data exposure

Frontend Testing
1. Route Protection
   - Test admin routes redirect non-admin users
   - Test admin login flow
   - Test admin logout

2. Component Tests
   - Test admin dashboard renders
   - Test user table displays correctly
   - Test pagination works
   - Test search/filter works

Manual Testing Checklist
- [ ] Admin can login
- [ ] Non-admin cannot access admin routes
- [ ] Dashboard shows correct statistics
- [ ] User list displays correctly
- [ ] User deletion works and cascades properly
- [ ] Group list displays correctly
- [ ] Group deletion works
- [ ] Pagination works
- [ ] Search works
- [ ] Filters work
- [ ] Mobile responsive

================================================================================

FILE STRUCTURE

Backend Files (New)
backend/
├── src/
│   ├── controllers/
│   │   └── admin.controller.js          (NEW)
│   ├── middleware/
│   │   └── auth.middleware.js           (MODIFIED - add requireAdmin)
│   ├── models/
│   │   └── User.js                      (MODIFIED - add role field)
│   └── routes/
│       └── admin.route.js               (NEW)
└── scripts/
    └── createAdmin.js                   (NEW - optional)

Frontend Files (New)
frontend/
├── src/
│   ├── components/
│   │   ├── AdminLayout.jsx              (NEW)
│   │   └── AdminProtectedRoute.jsx      (NEW)
│   ├── hooks/
│   │   └── useAdminAuth.js              (NEW - optional)
│   ├── pages/
│   │   ├── AdminLoginPage.jsx           (NEW)
│   │   └── admin/
│   │       ├── DashboardPage.jsx        (NEW)
│   │       ├── UsersPage.jsx            (NEW)
│   │       ├── GroupsPage.jsx           (NEW)
│   │       └── StatisticsPage.jsx       (NEW - optional)
│   ├── lib/
│   │   └── api.js                       (MODIFIED - add admin functions)
│   └── App.jsx                          (MODIFIED - add admin routes)

================================================================================

IMPLEMENTATION ORDER (Recommended)

Week 1: Backend Foundation
1. Add role field to User model
2. Create admin user (manual)
3. Create requireAdmin middleware
4. Create admin statistics controller
5. Create admin user management controller
6. Create admin routes
7. Test backend endpoints with Postman/Thunder Client

Week 2: Frontend Foundation
8. Create AdminLoginPage
9. Create AdminProtectedRoute
10. Create AdminLayout
11. Create DashboardPage (basic stats)
12. Add admin routes to App.jsx
13. Test admin login flow

Week 3: Frontend Features
14. Create UsersPage (list, search, pagination)
15. Implement user deletion
16. Create GroupsPage (list, search, pagination)
17. Implement group deletion
18. Polish UI/UX

Week 4: Testing & Polish
19. Security testing
20. Bug fixes
21. Performance optimization
22. Documentation
23. Deploy

================================================================================

IMPORTANT NOTES

1. Backward Compatibility
   - All existing users default to "user" role
   - Existing functionality remains unchanged
   - No breaking changes to existing APIs

2. Database Migration
   - No migration script needed (default value)
   - Existing users automatically have role: "user"
   - Only new admin users need role: "admin"

3. Stream Integration
   - When deleting users, also delete Stream users
   - When deleting groups, also delete Stream channels
   - Handle Stream errors gracefully

4. Error Handling
   - Admin routes should return clear error messages
   - Log errors for debugging
   - Don't expose internal errors to frontend

5. Performance
   - Use database indexes (already have some)
   - Implement pagination for large lists
   - Cache statistics if needed (future)
   - Optimize database queries

6. Scalability
   - Consider caching dashboard stats
   - Consider background jobs for statistics
   - Consider database aggregation pipelines

================================================================================

ROLLBACK PLAN

If something goes wrong:

1. Database: Remove role field from schema (but keep in code, default to "user")
2. Backend: Comment out admin routes
3. Frontend: Comment out admin routes
4. No data loss: All changes are additive

================================================================================

NEXT STEPS

After you approve this plan:

1. Phase 1: Start with database changes and middleware
2. Phase 2: Build backend controllers
3. Phase 3: Test backend thoroughly
4. Phase 4: Build frontend
5. Phase 5: Test and deploy

Ready to implement? Let me know which phase you'd like to start with, and I'll begin implementation!

================================================================================

Document Version: 1.0
Last Updated: [Current Date]
Author: AI Assistant
Status: Planning Phase - Awaiting Approval
